<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>javascripts/dashboard/LineChart.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <input type="text" id="nav-search" placeholder="Search" />
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/knoxjeffrey/personal_website" target="_blank" class="menu-item" id="repository" >Github repo</a></h2><h3>Classes</h3><ul><li><a href="CommentsController.html">CommentsController</a><ul class='members'><li data-type='member' style='display: none;'><a href="CommentsController.html#.targets">targets</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="CommentsController.html#load">load</a></li></ul></li><li><a href="Dashboard.CoreVitalsSummaryController.html">Dashboard.CoreVitalsSummaryController</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Dashboard.CoreVitalsSummaryController.html#alertColor">alertColor</a></li><li data-type='method' style='display: none;'><a href="Dashboard.CoreVitalsSummaryController.html#calculateMeanCoreVital">calculateMeanCoreVital</a></li><li data-type='method' style='display: none;'><a href="Dashboard.CoreVitalsSummaryController.html#connect">connect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.CoreVitalsSummaryController.html#isDataVizEmpty">isDataVizEmpty</a></li><li data-type='method' style='display: none;'><a href="Dashboard.CoreVitalsSummaryController.html#loadingMeanCoreVitalValue">loadingMeanCoreVitalValue</a></li><li data-type='method' style='display: none;'><a href="Dashboard.CoreVitalsSummaryController.html#reconnect">reconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.CoreVitalsSummaryController.html#removeAlertColors">removeAlertColors</a></li><li data-type='method' style='display: none;'><a href="Dashboard.CoreVitalsSummaryController.html#singleStackedBar">singleStackedBar</a></li><li data-type='method' style='display: none;'><a href="Dashboard.CoreVitalsSummaryController.html#storeUpdated">storeUpdated</a></li><li data-type='method' style='display: none;'><a href="Dashboard.CoreVitalsSummaryController.html#updateContextDistribution">updateContextDistribution</a></li><li data-type='method' style='display: none;'><a href="Dashboard.CoreVitalsSummaryController.html#updateMeanCoreVitalsValue">updateMeanCoreVitalsValue</a></li><li data-type='method' style='display: none;'><a href="Dashboard.CoreVitalsSummaryController.html#updateSummary">updateSummary</a></li></ul></li><li><a href="Dashboard.DataVisualisationController.html">Dashboard.DataVisualisationController</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Dashboard.DataVisualisationController.html#connect">connect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.DataVisualisationController.html#disconnect">disconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.DataVisualisationController.html#isDataVizEmpty">isDataVizEmpty</a></li><li data-type='method' style='display: none;'><a href="Dashboard.DataVisualisationController.html#lineChart">lineChart</a></li><li data-type='method' style='display: none;'><a href="Dashboard.DataVisualisationController.html#reconnect">reconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.DataVisualisationController.html#resize">resize</a></li><li data-type='method' style='display: none;'><a href="Dashboard.DataVisualisationController.html#storeUpdated">storeUpdated</a></li></ul></li><li><a href="Dashboard.FrameController.html">Dashboard.FrameController</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Dashboard.FrameController.html#connect">connect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.FrameController.html#disconnect">disconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.FrameController.html#frameSelected">frameSelected</a></li></ul></li><li><a href="Dashboard.FrameLoaderController.html">Dashboard.FrameLoaderController</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Dashboard.FrameLoaderController.html#connect">connect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.FrameLoaderController.html#disconnect">disconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.FrameLoaderController.html#reconnect">reconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.FrameLoaderController.html#storeUpdated">storeUpdated</a></li></ul></li><li><a href="Dashboard.HistogramController.html">Dashboard.HistogramController</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Dashboard.HistogramController.html#connect">connect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.HistogramController.html#disconnect">disconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.HistogramController.html#histogram">histogram</a></li><li data-type='method' style='display: none;'><a href="Dashboard.HistogramController.html#isDataVizEmpty">isDataVizEmpty</a></li><li data-type='method' style='display: none;'><a href="Dashboard.HistogramController.html#reconnect">reconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.HistogramController.html#resize">resize</a></li><li data-type='method' style='display: none;'><a href="Dashboard.HistogramController.html#storeUpdated">storeUpdated</a></li></ul></li><li><a href="Dashboard.MeanBuildTimesController.html">Dashboard.MeanBuildTimesController</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Dashboard.MeanBuildTimesController.html#alertColor">alertColor</a></li><li data-type='method' style='display: none;'><a href="Dashboard.MeanBuildTimesController.html#calculateMeanBuildTime">calculateMeanBuildTime</a></li><li data-type='method' style='display: none;'><a href="Dashboard.MeanBuildTimesController.html#connect">connect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.MeanBuildTimesController.html#disconnect">disconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.MeanBuildTimesController.html#disconnect">disconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.MeanBuildTimesController.html#loadingMeanBuildTimesValue">loadingMeanBuildTimesValue</a></li><li data-type='method' style='display: none;'><a href="Dashboard.MeanBuildTimesController.html#reconnect">reconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.MeanBuildTimesController.html#removeAlertColors">removeAlertColors</a></li><li data-type='method' style='display: none;'><a href="Dashboard.MeanBuildTimesController.html#storeUpdated">storeUpdated</a></li><li data-type='method' style='display: none;'><a href="Dashboard.MeanBuildTimesController.html#updateMeanBuildTimesValue">updateMeanBuildTimesValue</a></li></ul></li><li><a href="Dashboard.MonthsController.html">Dashboard.MonthsController</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Dashboard.MonthsController.html#connect">connect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.MonthsController.html#disconnect">disconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.MonthsController.html#fetchDataVizData">fetchDataVizData</a></li><li data-type='method' style='display: none;'><a href="Dashboard.MonthsController.html#monthClicked">monthClicked</a></li><li data-type='method' style='display: none;'><a href="Dashboard.MonthsController.html#reconnect">reconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.MonthsController.html#storeUpdated">storeUpdated</a></li><li data-type='method' style='display: none;'><a href="Dashboard.MonthsController.html#yearSelectedValueChanged">yearSelectedValueChanged</a></li></ul></li><li><a href="Dashboard.SelectContextController.html">Dashboard.SelectContextController</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Dashboard.SelectContextController.html#connect">connect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.SelectContextController.html#contextClicked">contextClicked</a></li><li data-type='method' style='display: none;'><a href="Dashboard.SelectContextController.html#contextSelected">contextSelected</a></li><li data-type='method' style='display: none;'><a href="Dashboard.SelectContextController.html#disconnect">disconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.SelectContextController.html#reconnect">reconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.SelectContextController.html#selectContextData">selectContextData</a></li><li data-type='method' style='display: none;'><a href="Dashboard.SelectContextController.html#storeUpdated">storeUpdated</a></li></ul></li><li><a href="Dashboard.SuccessfulBuildsController.html">Dashboard.SuccessfulBuildsController</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Dashboard.SuccessfulBuildsController.html#calculateNumberOfBuilds">calculateNumberOfBuilds</a></li><li data-type='method' style='display: none;'><a href="Dashboard.SuccessfulBuildsController.html#connect">connect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.SuccessfulBuildsController.html#disconnect">disconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.SuccessfulBuildsController.html#loadingSuccessfulBuildsValue">loadingSuccessfulBuildsValue</a></li><li data-type='method' style='display: none;'><a href="Dashboard.SuccessfulBuildsController.html#reconnect">reconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.SuccessfulBuildsController.html#storeUpdated">storeUpdated</a></li><li data-type='method' style='display: none;'><a href="Dashboard.SuccessfulBuildsController.html#updateSuccessfulBuildsValue">updateSuccessfulBuildsValue</a></li></ul></li><li><a href="Dashboard.YearsController.html">Dashboard.YearsController</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Dashboard.YearsController.html#connect">connect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.YearsController.html#disconnect">disconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.YearsController.html#reconnect">reconnect</a></li><li data-type='method' style='display: none;'><a href="Dashboard.YearsController.html#statusValueChanged">statusValueChanged</a></li><li data-type='method' style='display: none;'><a href="Dashboard.YearsController.html#storeUpdated">storeUpdated</a></li><li data-type='method' style='display: none;'><a href="Dashboard.YearsController.html#yearClicked">yearClicked</a></li><li data-type='method' style='display: none;'><a href="Dashboard.YearsController.html#yearsAndMonths">yearsAndMonths</a></li></ul></li><li><a href="Game.EPController.html">Game.EPController</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Game.EPController.html#initialize">initialize</a></li></ul></li><li><a href="Game.HIPSController.html">Game.HIPSController</a><ul class='members'><li data-type='member' style='display: none;'><a href="Game.HIPSController.html#.targets">targets</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="Game.HIPSController.html#submit">submit</a></li></ul></li><li><a href="Game.LTBLController.html">Game.LTBLController</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Game.LTBLController.html#next">next</a></li></ul></li><li><a href="Game.MOTController.html">Game.MOTController</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Game.MOTController.html#connect">connect</a></li></ul></li><li><a href="Game.MYMController.html">Game.MYMController</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Game.MYMController.html#connect">connect</a></li></ul></li><li><a href="Game.RDController.html">Game.RDController</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Game.RDController.html#connect">connect</a></li></ul></li><li><a href="javascripts.dashboard.LineChart.html">javascripts.dashboard.LineChart</a><ul class='methods'><li data-type='method' style='display: none;'><a href="javascripts.dashboard.LineChart.html#closestDataPoint">closestDataPoint</a></li><li data-type='method' style='display: none;'><a href="javascripts.dashboard.LineChart.html#createDataVis">createDataVis</a></li><li data-type='method' style='display: none;'><a href="javascripts.dashboard.LineChart.html#initialiseAccessors">initialiseAccessors</a></li><li data-type='method' style='display: none;'><a href="javascripts.dashboard.LineChart.html#initialiseDataVis">initialiseDataVis</a></li><li data-type='method' style='display: none;'><a href="javascripts.dashboard.LineChart.html#kpiLineTransition">kpiLineTransition</a></li><li data-type='method' style='display: none;'><a href="javascripts.dashboard.LineChart.html#setGenerators">setGenerators</a></li><li data-type='method' style='display: none;'><a href="javascripts.dashboard.LineChart.html#setScales">setScales</a></li><li data-type='method' style='display: none;'><a href="javascripts.dashboard.LineChart.html#tweenDashIn">tweenDashIn</a></li><li data-type='method' style='display: none;'><a href="javascripts.dashboard.LineChart.html#updateDataVis">updateDataVis</a></li></ul></li><li><a href="RUMController.html">RUMController</a><ul class='members'><li data-type='member' style='display: none;'><a href="RUMController.html#.classes">classes</a></li><li data-type='member' style='display: none;'><a href="RUMController.html#.rumIdentifier">rumIdentifier</a></li><li data-type='member' style='display: none;'><a href="RUMController.html#.targets">targets</a></li><li data-type='member' style='display: none;'><a href="RUMController.html#.values">values</a></li></ul><ul class='methods'><li data-type='method' style='display: none;'><a href="RUMController.html#alertColor">alertColor</a></li><li data-type='method' style='display: none;'><a href="RUMController.html#alertSubstring">alertSubstring</a></li><li data-type='method' style='display: none;'><a href="RUMController.html#clsValueChanged">clsValueChanged</a></li><li data-type='method' style='display: none;'><a href="RUMController.html#coreWebVitalResponse">coreWebVitalResponse</a></li><li data-type='method' style='display: none;'><a href="RUMController.html#disconnect">disconnect</a></li><li data-type='method' style='display: none;'><a href="RUMController.html#fidValueChanged">fidValueChanged</a></li><li data-type='method' style='display: none;'><a href="RUMController.html#initialize">initialize</a></li><li data-type='method' style='display: none;'><a href="RUMController.html#lcpValueChanged">lcpValueChanged</a></li><li data-type='method' style='display: none;'><a href="RUMController.html#organiseDataBasedOnMetric">organiseDataBasedOnMetric</a></li><li data-type='method' style='display: none;'><a href="RUMController.html#reveal">reveal</a></li><li data-type='method' style='display: none;'><a href="RUMController.html#rumLogger">rumLogger</a></li><li data-type='method' style='display: none;'><a href="RUMController.html#visitorIsBot">visitorIsBot</a></li></ul></li></ul><h3>Namespaces</h3><ul><li><a href="javascripts.dashboard.Chart_modules.html">javascripts.dashboard.Chart_modules</a></li><li><a href="javascripts.dashboard.utils.html">javascripts.dashboard.utils</a><ul class='methods'><li data-type='method' style='display: none;'><a href="javascripts.dashboard.utils.html#.allowClicks">allowClicks</a></li><li data-type='method' style='display: none;'><a href="javascripts.dashboard.utils.html#.axisMeasurementValues">axisMeasurementValues</a></li><li data-type='method' style='display: none;'><a href="javascripts.dashboard.utils.html#.axisTextValues">axisTextValues</a></li><li data-type='method' style='display: none;'><a href="javascripts.dashboard.utils.html#.metricsInPercentile">metricsInPercentile</a></li><li data-type='method' style='display: none;'><a href="javascripts.dashboard.utils.html#.minAxisValues">minAxisValues</a></li><li data-type='method' style='display: none;'><a href="javascripts.dashboard.utils.html#.percentileValue">percentileValue</a></li><li data-type='method' style='display: none;'><a href="javascripts.dashboard.utils.html#.sortNumberArray">sortNumberArray</a></li><li data-type='method' style='display: none;'><a href="javascripts.dashboard.utils.html#.targetLineValues">targetLineValues</a></li></ul></li><li><a href="javascripts.pushr.dispatchers.index.html">javascripts.pushr.dispatchers.index</a></li><li><a href="javascripts.pushr.dispatchers.rum.html">javascripts.pushr.dispatchers.rum</a><ul class='methods'><li data-type='method' style='display: none;'><a href="javascripts.pushr.dispatchers.rum.html#.batchPostRumData">batchPostRumData</a></li><li data-type='method' style='display: none;'><a href="javascripts.pushr.dispatchers.rum.html#.leavePageDispatcher">leavePageDispatcher</a></li><li data-type='method' style='display: none;'><a href="javascripts.pushr.dispatchers.rum.html#.pushrDispatcher">pushrDispatcher</a></li></ul></li><li><a href="javascripts.pushr.index.html">javascripts.pushr.index</a><ul class='methods'><li data-type='method' style='display: none;'><a href="javascripts.pushr.index.html#.log">log</a></li><li data-type='method' style='display: none;'><a href="javascripts.pushr.index.html#.pushrInit">pushrInit</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">javascripts/dashboard/LineChart.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import d3 from "~/javascripts/dashboard/d3_modules"
import { 
  targetLineValues, minAxisValues, axisTextValues, axisMeasurementValues, allowClicks
} from "~/javascripts/dashboard/utils"

/**
 * @class javascripts.dashboard.LineChart
 * @classdesc d3.js line chart for Netlify build times
 */
export default class LineChart {
  constructor(selectedData, selectedContext, yKey, xKey, dateKey, timeFormat, wrapper, tooltip) {
    this.selectedData = selectedData
    this.selectedContext = selectedContext
    this.yKey = yKey
    this.xKey = xKey
    this.dateKey = dateKey
    this.timeFormat = timeFormat
    this.wrapper = d3.select(wrapper)
    this.tooltip = d3.select(tooltip)
    this.tooltipCircle = null
    this.touchEvent = false
    this.dv = {
      yAccessor: null,
      xAccessor: null,
      dateAccessor: null,
      deployIdAccessor: null,
      yScale: null,
      xScale: null,
      yAxisGenerator: null,
      xAxisGenerator: null,
      lineGenerator: null,
      bounds: null
    }
    this.dimensions = {
      width: parseInt(this.wrapper.style("width"), 10),
      height: 400,
      margin: {
        top: 15,
        right: 10,
        bottom: 40,
        left: 35,
      }
    }
    this.dimensions.boundedWidth = this.dimensions.width
      - this.dimensions.margin.left
      - this.dimensions.margin.right
    this.dimensions.boundedHeight = this.dimensions.height
      - this.dimensions.margin.top
      - this.dimensions.margin.bottom
  }

  /** 
   * Called the first time the page is loaded to setup the visualisation
   *
   * @instance
   * @memberof javascripts.dashboard.LineChart
   **/
  createDataVis() {
    this.initialiseAccessors()
    this.setScales()
    this.setGenerators()
    this.initialiseDataVis()
    this.kpiLineTransition()
  }

  /** 
   * When the data set is updated this will cause the visualisation to animate
   *
   * @instance
   * @memberof javascripts.dashboard.LineChart
   **/
  updateDataVis(selectedData, selectedContext) {
    this.selectedData = selectedData
    this.selectedContext = selectedContext

    const data = this.selectedData
    const updatedLine = this.dv.bounds.select("path").data(data)

    this.setScales()
    this.setGenerators()

    updatedLine.attr("d", this.dv.lineGenerator(data))
        .call(this.lineTransitionIn)
    this.dv.bounds.select(".line-chart--y-axis")
        .transition().duration(250)
        .call(this.dv.yAxisGenerator)
    this.dv.bounds.select(".line-chart--x-axis")
        .transition().duration(250)
        .call(this.dv.xAxisGenerator)
    this.kpiLineTransition()
  }

  /** 
   * Setup the accessors for the visualisation
   *
   * @instance
   * @memberof javascripts.dashboard.LineChart
   **/
  initialiseAccessors() {
    this.dv.yAccessor = d => d[this.yKey]
    this.dv.xAccessor = d => d[this.xKey] 
    this.dv.dateAccessor = d => new Date(d[this.dateKey])
    this.dv.deployIdAccessor = d => d.deploy_id
  }

  /** 
   * Setup the scales for the visualisation which can be updated as the data set changes
   *
   * @instance
   * @memberof javascripts.dashboard.LineChart
   **/
  setScales() {
    this.dv.yScale = d3.scaleLinear()
      .domain([
        0, d3.max(
          [minAxisValues(this.selectedContext), d3.max(this.selectedData.map(data => data[this.yKey]))
        ])
      ])
      .range([this.dimensions.boundedHeight, 0])
      .nice()
    this.dv.xScale = d3.scaleLinear()
      .domain(d3.extent(this.selectedData, this.dv.xAccessor))
      .range([0, this.dimensions.boundedWidth])
  }

  /** 
   * Setup the generators for the visualisation which can be updated as the data set changes
   *
   * @instance
   * @memberof javascripts.dashboard.LineChart
   **/
  setGenerators() {
    this.dv.yAxisGenerator = d3.axisLeft()
      .scale(this.dv.yScale)
    this.dv.xAxisGenerator = d3.axisBottom()
      .scale(this.dv.xScale)
    if (this.selectedData.length &lt; 10) {
      this.dv.xAxisGenerator = this.dv.xAxisGenerator
        .tickValues(this.selectedData.map(data => data[this.xKey]))
        .tickFormat(d3.format(".0f"))
    }
    // Duration line generator with animation
    this.dv.lineGenerator = d3.line()
      .x(d => this.dv.xScale(this.dv.xAccessor(d)))
      .y(d => this.dv.yScale(this.dv.yAccessor(d)))
      .curve(d3.curveMonotoneX)
  }

  /** 
   * Setup the structure of the visualisation
   *
   * @instance
   * @memberof javascripts.dashboard.LineChart
   **/
  initialiseDataVis() {
    // Draw canvas
    const wrapperSvg = this.wrapper.append("svg")
      .attr("width", this.dimensions.width)
      .attr("height", this.dimensions.height)

    // Draw the bounds
    this.dv.bounds = wrapperSvg.append("g")
        .style("transform", `translate(${
          this.dimensions.margin.left
        }px, ${
          this.dimensions.margin.top
        }px)`)

    // Setup listener rect for mouse overs
    const listeningRect = this.dv.bounds.append("rect")
        .attr("class", "line-chart--listening-rect")
        .attr("width", this.dimensions.boundedWidth)
        .attr("height", this.dimensions.boundedHeight)
        .on("touchstart", this.onTouchStart, { passive: false })
        .on("mousemove touchmove", this.onMouseMove, { passive: true })
        .on("mouseleave touchend", this.onMouseLeave)
        .on("click", this.onClick)

    // Setup tooltip when mousing over the listener rect
    this.tooltipCircle = this.dv.bounds.append("circle")
        .attr("class", "line-chart--tooltip-circle")
        .attr("r", 4)

    // Setup the data visualisation graph line
    const line = this.dv.bounds.append("path")
        .attr("class", "line-chart--path")
        .attr("d", this.dv.lineGenerator(this.selectedData))
        .call(this.lineTransitionIn)

    // Setup axis
    const yAxis = this.dv.bounds.append("g")
        .attr("class", "line-chart--y-axis")
        .call(this.dv.yAxisGenerator)

    const xAxis = this.dv.bounds.append("g")
        .attr("class", "line-chart--x-axis")
        .call(this.dv.xAxisGenerator)
          .style("transform", `translateY(${
            this.dimensions.boundedHeight
          }px)`)
      .append("text")
        .attr("class", "line-chart--x-axis-label")
        .attr("x", this.dimensions.boundedWidth / 2)
        .attr("y", this.dimensions.margin.bottom - 5)
        .text(axisTextValues(this.selectedContext))

    // Setup KPI lines to start from zero on y axis. These will animate into position with kpiLineTransition
    const targetKpiLine = this.dv.bounds.append("line")
        .attr("class", "line-chart--success-line")
        .attr("x1", this.dv.xScale(this.dv.xAccessor(this.selectedData)))
        .attr("x2", this.dimensions.boundedWidth)
        .attr("y1", this.dv.yScale(0))
        .attr("y2", this.dv.yScale(0))

    const lowerBoundtKpiLine = this.dv.bounds.append("line")
        .attr("class", "line-chart--fail-line")
        .attr("x1", this.dv.xScale(this.dv.xAccessor(this.selectedData)))
        .attr("x2", this.dimensions.boundedWidth)
        .attr("y1", this.dv.yScale(0))
        .attr("y2", this.dv.yScale(0))
  }

  /** 
   * Animate new line drawing in
   *
   * @instance
   * @memberof javascripts.dashboard.LineChart
   **/
  lineTransitionIn = path => {
    path.transition().duration(500)
        .attrTween("stroke-dasharray", this.tweenDashIn)
  }

  /** 
   * Animate new line drawing in
   *
   * @instance
   * @memberof javascripts.dashboard.LineChart
   **/
  tweenDashIn() {
    const length = this.getTotalLength()
    const i = d3.interpolateString(`0, ${length}`, `${length}, ${length}`)
    return function (t) { return i(t) }
  }

  /** 
   * Animate KPI lines
   *
   * @instance
   * @memberof javascripts.dashboard.LineChart
   **/
  kpiLineTransition() {
    const data = this.selectedData
    const lineValues = targetLineValues(this.selectedContext)

    this.dv.bounds.select(".line-chart--success-line")
        .transition().duration(250)
        .attr("x1", this.dv.xScale(this.dv.xAccessor(data)))
        .attr("x2", this.dimensions.boundedWidth)
        .attr("y1", this.dv.yScale(lineValues.successLineValue))
        .attr("y2", this.dv.yScale(lineValues.successLineValue))

    this.dv.bounds.select(".line-chart--fail-line")
        .transition().duration(250)
        .attr("x1", this.dv.xScale(this.dv.xAccessor(data)))
        .attr("x2", this.dimensions.boundedWidth)
        .attr("y1", this.dv.yScale(lineValues.failLineValue))
        .attr("y2", this.dv.yScale(lineValues.failLineValue))
  }

  /** 
   *  Prevent default on touch start which stops the entire page moving when a finger drags on the
   * interface. On touch screens the tool tip stays on the screen after dragging but a brief touch will
   * clear it.
   *
   * @instance
   * @memberof javascripts.dashboard.LineChart
   **/
  onTouchStart = event => {
    this.onMouseMove(event)
    event.preventDefault()
  }

  /** 
   *  Calculate which data point is selected on mouseover. Prevent when no builds present.
   *
   * @instance
   * @memberof javascripts.dashboard.LineChart
   **/
  onMouseMove = event => {
    if(this.selectedData[0].build_number === 0) return
    
    const closestDataset = this.closestDataPoint(event)
    const closestXValue = this.dv.xAccessor(closestDataset)
    const closestYValue = this.dv.yAccessor(closestDataset)

    const formatDate = d3.timeFormat(this.timeFormat)
    this.tooltip.select("[data-viz='date']")
        .text(formatDate(this.dv.dateAccessor(closestDataset)))

    this.tooltip.select("[data-viz='duration']")
        .html(`${closestYValue}${axisMeasurementValues(this.selectedContext)}`)

    const x = this.dv.xScale(closestXValue) + this.dimensions.margin.left
    const y = this.dv.yScale(closestYValue) + this.dimensions.margin.top

    this.tooltip.style("transform", `translate(`
      + `calc( -50% + ${x}px),`
      + `calc(-100% + ${y}px)`
      + `)`)

    this.tooltip.transition().duration(25)
        .style("opacity", 1)

    this.tooltipCircle.transition().duration(25)
        .attr("cx", this.dv.xScale(closestXValue))
        .attr("cy", this.dv.yScale(closestYValue))
        .style("opacity", 1)
  }

  /** 
   *  Handle mouse leave
   *
   * @instance
   * @memberof javascripts.dashboard.LineChart
   **/
  onMouseLeave = () => {
    this.tooltip.transition().duration(25)
        .style("opacity", 0)
    this.tooltipCircle.transition().duration(25)
        .style("opacity", 0)
  }

  /** 
   *  Open Netlify build logs for selected build. Prevent clicks when no builds present
   *
   * @instance
   * @memberof javascripts.dashboard.LineChart
   **/
  onClick = event => {
    if(this.selectedData[0].build_number === 0) return
    if(!allowClicks(this.selectedContext)) return
    
    const deployId = this.dv.deployIdAccessor(this.closestDataPoint(event))
    window.open(
      `https://app.netlify.com/sites/jeffreyknox/deploys/${deployId}`, '_blank'
    )
  }

  /** 
   *  Get the closest data point based on mouse position in listening rect. Also handles a touch event
   * for a finger dragging on the interface.
   *
   * @instance
   * @memberof javascripts.dashboard.LineChart
   **/
  closestDataPoint(event) {
    if (window.TouchEvent &amp;&amp; event instanceof TouchEvent) event = event.touches[0];
    const mousePosition = d3.pointer(event, event.target)
    const hoveredDate = this.dv.xScale.invert(mousePosition[0])

    const getDistanceFromHoveredDate = d => Math.abs(this.dv.xAccessor(d) - hoveredDate)
    const closestIndex = d3.leastIndex(this.selectedData, (a, b) => (
      getDistanceFromHoveredDate(a) - getDistanceFromHoveredDate(b)
    ))
    return this.selectedData[closestIndex]
  }
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.7</a> using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>

<script src="scripts/search.js" defer></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
